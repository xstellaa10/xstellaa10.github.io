<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AC Elite - Simracing Community</title>
    <meta
      name="description"
      content="AC Elite | Track your stats, compete on leaderboards, and join the community."
    />
    <link rel="icon" type="image/png" href="logo.png" />

    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --gold-primary: #d4af37;
        --gold-light: #f4e076;
        --gold-dark: #b8960c;
        --blue-dark: #0a1628;
        --blue-medium: #0f2341;
        --blue-light: #1a3a5c;
      }

      * {
        scrollbar-width: thin;
        scrollbar-color: var(--gold-primary) var(--blue-dark);
      }

      *::-webkit-scrollbar {
        width: 8px;
      }

      *::-webkit-scrollbar-track {
        background: var(--blue-dark);
      }

      *::-webkit-scrollbar-thumb {
        background: var(--gold-primary);
        border-radius: 4px;
      }

      .font-racing {
        font-family: "Orbitron", sans-serif;
      }
      .font-body {
        font-family: "Inter", sans-serif;
      }

      /* Gradients */
      .gold-gradient {
        background: linear-gradient(
          135deg,
          #b8960c 0%,
          #d4af37 25%,
          #f4e076 50%,
          #d4af37 75%,
          #b8960c 100%
        );
      }

      .blue-gradient {
        background: linear-gradient(
          180deg,
          #0a1628 0%,
          #0f2341 50%,
          #0a1628 100%
        );
      }

      .glass {
        background: rgba(15, 35, 65, 0.6);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(212, 175, 55, 0.1);
      }

      .glass-card {
        background: linear-gradient(
          135deg,
          rgba(15, 35, 65, 0.8) 0%,
          rgba(10, 22, 40, 0.9) 100%
        );
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(212, 175, 55, 0.15);
        transition: all 0.3s ease;
      }

      .glass-card:hover {
        border-color: rgba(212, 175, 55, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3),
          0 0 30px rgba(212, 175, 55, 0.1);
      }

      /* Glows */
      .glow-gold {
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.3),
          0 0 40px rgba(212, 175, 55, 0.1);
      }

      .glow-gold-strong {
        box-shadow: 0 0 30px rgba(212, 175, 55, 0.5),
          0 0 60px rgba(212, 175, 55, 0.2);
      }

      .text-glow {
        text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
      }

      /* Leaderboard positions */
      .top1 {
        background: linear-gradient(
          90deg,
          rgba(255, 215, 0, 0.15) 0%,
          transparent 100%
        );
        border-left: 4px solid #ffd700;
      }
      .top2 {
        background: linear-gradient(
          90deg,
          rgba(192, 192, 192, 0.12) 0%,
          transparent 100%
        );
        border-left: 4px solid #c0c0c0;
      }
      .top3 {
        background: linear-gradient(
          90deg,
          rgba(205, 127, 50, 0.12) 0%,
          transparent 100%
        );
        border-left: 4px solid #cd7f32;
      }
      .top10 {
        background: linear-gradient(
          90deg,
          rgba(59, 130, 246, 0.08) 0%,
          transparent 100%
        );
        border-left: 4px solid #3b82f6;
      }

      /* Licences (voor later, maar styles mogen blijven) */
      .licence-platinum {
        background: linear-gradient(
          135deg,
          #e5e4e2 0%,
          #a8a8a8 50%,
          #e5e4e2 100%
        );
        box-shadow: 0 0 15px rgba(229, 228, 226, 0.3);
      }
      .licence-gold {
        background: linear-gradient(
          135deg,
          #b8960c 0%,
          #d4af37 25%,
          #f4e076 50%,
          #d4af37 75%,
          #b8960c 100%
        );
        box-shadow: 0 0 15px rgba(212, 175, 55, 0.4);
      }
      .licence-silver {
        background: linear-gradient(
          135deg,
          #a0a0a0 0%,
          #c0c0c0 50%,
          #e0e0e0 75%,
          #c0c0c0 100%
        );
        box-shadow: 0 0 15px rgba(192, 192, 192, 0.3);
      }
      .licence-bronze {
        background: linear-gradient(
          135deg,
          #8b5a2b 0%,
          #cd7f32 50%,
          #daa06d 75%,
          #cd7f32 100%
        );
        box-shadow: 0 0 15px rgba(205, 127, 50, 0.3);
      }

      /* Autocomplete */
      .autocomplete-container {
        position: relative;
      }
      .autocomplete-results {
        position: absolute;
        top: calc(100% + 4px);
        left: 0;
        right: 0;
        background: rgba(15, 35, 65, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(212, 175, 55, 0.2);
        border-radius: 12px;
        max-height: 320px;
        overflow-y: auto;
        z-index: 50;
        display: none;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
      }
      .autocomplete-results.show {
        display: block;
      }
      .autocomplete-item {
        padding: 14px 18px;
        cursor: pointer;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.2s ease;
      }
      .autocomplete-item:hover {
        background: rgba(212, 175, 55, 0.1);
      }
      .autocomplete-item:last-child {
        border-bottom: none;
      }
      .autocomplete-name {
        font-weight: 600;
        color: #fff;
        margin-bottom: 2px;
      }
      .autocomplete-guid {
        font-size: 0.75rem;
        color: #64748b;
        font-family: monospace;
      }

      /* Buttons */
      .btn-gold {
        background: linear-gradient(
          135deg,
          #b8960c 0%,
          #d4af37 50%,
          #f4e076 100%
        );
        color: #0a1628;
        font-weight: 700;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
      }

      .btn-gold:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
      }

      .btn-ghost {
        background: transparent;
        border: 1px solid rgba(212, 175, 55, 0.3);
        color: #d4af37;
        transition: all 0.3s ease;
      }

      .btn-ghost:hover {
        background: rgba(212, 175, 55, 0.1);
        border-color: rgba(212, 175, 55, 0.6);
      }

      .btn-ghost.active {
        background: rgba(212, 175, 55, 0.15);
        border-color: #d4af37;
      }

      /* Stat cards */
      .stat-card {
        background: linear-gradient(
          135deg,
          rgba(15, 35, 65, 0.6) 0%,
          rgba(10, 22, 40, 0.8) 100%
        );
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 16px;
        padding: 24px;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        border-color: rgba(212, 175, 55, 0.3);
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      }

      /* Input fields */
      .input-modern {
        background: rgba(15, 35, 65, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        padding: 16px 20px;
        color: #fff;
        transition: all 0.3s ease;
        font-size: 16px;
      }

      .input-modern:focus {
        outline: none;
        border-color: #d4af37;
        box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
      }

      .input-modern::placeholder {
        color: rgba(255, 255, 255, 0.4);
      }

      .btn-disabled {
        background: transparent;
        border: 1px solid rgba(148, 163, 184, 0.5); /* slate-400-ish */
        color: #64748b; /* slate-500-ish */
        cursor: not-allowed;
        opacity: 0.6;
        transition: all 0.3s ease;
      }

      .btn-disabled:hover {
        background: transparent;
        border-color: rgba(148, 163, 184, 0.7);
      }

      /* Animations */
      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      @keyframes pulse-glow {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }
        50% {
          box-shadow: 0 0 40px rgba(212, 175, 55, 0.6);
        }
      }

      @keyframes shimmer {
        0% {
          background-position: -200% center;
        }
        100% {
          background-position: 200% center;
        }
      }

      .animate-float {
        animation: float 6s ease-in-out infinite;
      }

      .animate-pulse-glow {
        animation: pulse-glow 2s ease-in-out infinite;
      }

      .hero-pattern {
        background-image: radial-gradient(
            circle at 20% 50%,
            rgba(212, 175, 55, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 50%,
            rgba(59, 130, 246, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 50% 100%,
            rgba(212, 175, 55, 0.05) 0%,
            transparent 50%
          );
      }

      /* Table styling */
      .table-modern {
        border-collapse: separate;
        border-spacing: 0;
      }

      .table-modern th {
        background: rgba(15, 35, 65, 0.8);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.75rem;
        letter-spacing: 0.05em;
      }

      .table-modern tbody tr {
        transition: all 0.2s ease;
      }

      .table-modern tbody tr:hover {
        background: rgba(212, 175, 55, 0.05);
      }

      /* Logo styling */
      .logo-container {
        width: 48px;
        height: 48px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        border: 2px solid rgba(212, 175, 55, 0.3);
      }

      .logo-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Page transitions */
      .page {
        opacity: 1;
        transition: opacity 0.3s ease;
      }

      .page.hidden {
        display: none;
      }
    </style>
  </head>
  <body class="font-body bg-[#0a1628] text-white min-h-screen">
    <!-- Navigation -->
    <nav class="glass border-b border-amber-500/20 sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4">
        <div class="flex items-center justify-between">
          <!-- Logo & Brand -->
          <div class="flex items-center gap-4">
            <div class="logo-container animate-pulse-glow">
              <img
                src="logo.png"
                alt="AC Elite Logo"
                onerror="this.parentElement.innerHTML='<div class=\'w-full h-full gold-gradient flex items-center justify-center\'><span class=\'font-racing font-black text-[#0a1628] text-lg\'>AC</span></div>'"
              />
            </div>
            <div>
              <h1
                class="font-racing text-xl sm:text-2xl font-bold text-amber-400 text-glow"
              >
                AC ELITE
              </h1>
              <p class="text-xs text-slate-400 hidden sm:block">
                Simracing community
              </p>
            </div>
          </div>

          <!-- Navigation Buttons -->
          <div class="flex gap-2 sm:gap-3">
            <button
              onclick="showPage('stats')"
              id="nav-stats"
              class="nav-btn btn-ghost active px-3 sm:px-5 py-2.5 rounded-xl font-semibold text-sm sm:text-base"
            >
              <span class="hidden sm:inline">üìä </span>Stats
            </button>
            <button
              onclick="showPage('leaderboard')"
              id="nav-leaderboard"
              class="nav-btn btn-ghost px-3 sm:px-5 py-2.5 rounded-xl font-semibold text-sm sm:text-base"
            >
              <span class="hidden sm:inline">üèÜ </span>Leaderboard
            </button>
            <button
              onclick="showComingSoon()"
              id="nav-shop"
              class="nav-btn btn-disabled px-3 sm:px-5 py-2.5 rounded-xl font-semibold text-sm sm:text-base"
            >
              <span class="hidden sm:inline">üõ†Ô∏è </span>Setups
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Loading Overlay -->
    <div
      id="loading-overlay"
      class="fixed inset-0 bg-[#0a1628]/95 z-[100] flex items-center justify-center"
    >
      <div class="text-center">
        <div class="relative w-20 h-20 mx-auto mb-6">
          <div
            class="absolute inset-0 border-4 border-amber-500/20 rounded-full"
          ></div>
          <div
            class="absolute inset-0 border-4 border-transparent border-t-amber-500 rounded-full animate-spin"
          ></div>
          <div
            class="absolute inset-2 border-4 border-transparent border-t-amber-400 rounded-full animate-spin"
            style="animation-direction: reverse; animation-duration: 1.5s"
          ></div>
        </div>
        <p class="font-racing text-amber-400 text-xl text-glow mb-2">
          Loading Data
        </p>
        <p class="text-slate-500 text-sm" id="loading-status">
          Connecting to server...
        </p>
      </div>
    </div>

    <!-- Hero Banner -->
    <div class="hero-pattern py-10 border-b border-amber-500/10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <p class="text-slate-400 mb-4 text-sm sm:text-base">
          Weekly Track Rotation ‚Ä¢ Vote on Discord ‚Ä¢ Compete for Glory
        </p>
        <div
          id="data-status"
          class="inline-flex items-center gap-3 glass px-5 py-2.5 rounded-full"
        >
          <span class="relative flex h-2.5 w-2.5">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-yellow-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-2.5 w-2.5 bg-yellow-500"
            ></span>
          </span>
          <span class="text-sm text-yellow-300">Connecting...</span>
        </div>
      </div>
    </div>

    <!-- Stats Page -->
    <div id="page-stats" class="page max-w-7xl mx-auto px-4 sm:px-6 py-10">
      <!-- Header -->
      <div class="mb-10">
        <h2
          class="font-racing text-3xl sm:text-4xl font-bold text-amber-400 text-glow mb-2"
        >
          Driver Statistics
        </h2>
        <p class="text-slate-400">
          Search for any driver to view their complete racing profile
        </p>
      </div>

      <!-- Search Box -->
      <div class="glass-card rounded-2xl p-6 sm:p-8 mb-8">
        <div class="flex flex-col sm:flex-row gap-4 items-stretch sm:items-end">
          <div class="flex-1 autocomplete-container">
            <label class="block text-slate-300 text-sm font-medium mb-3"
              >Search Driver</label
            >
            <input
              type="text"
              id="driver-search"
              placeholder="Enter driver name or Steam64 ID..."
              class="input-modern w-full"
              autocomplete="off"
            />
            <div id="autocomplete-results" class="autocomplete-results"></div>
          </div>
          <button
            onclick="searchDriver()"
            class="btn-gold px-8 py-4 rounded-xl text-base flex items-center justify-center gap-2"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
            Search
          </button>
        </div>
      </div>

      <!-- Quick Stats -->
      <div
        id="quick-stats"
        class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-10"
      >
        <div class="stat-card text-center">
          <p
            class="text-4xl sm:text-5xl font-racing text-amber-400 mb-2"
            id="total-drivers"
          >
            -
          </p>
          <p class="text-slate-400 text-sm font-medium">Total Drivers</p>
        </div>
        <div class="stat-card text-center">
          <p
            class="text-4xl sm:text-5xl font-racing text-blue-400 mb-2"
            id="total-tracks"
          >
            -
          </p>
          <p class="text-slate-400 text-sm font-medium">Active Tracks</p>
        </div>
        <div class="stat-card text-center">
          <p
            class="text-4xl sm:text-5xl font-racing text-emerald-400 mb-2"
            id="total-laps"
          >
            -
          </p>
          <p class="text-slate-400 text-sm font-medium">Total Lap Times</p>
        </div>
        <div class="stat-card text-center">
          <p
            class="text-4xl sm:text-5xl font-racing text-purple-400 mb-2"
            id="total-km"
          >
            -
          </p>
          <p class="text-slate-400 text-sm font-medium">Total KM Driven</p>
        </div>
      </div>

      <!-- Driver Stats Display -->
      <div id="driver-stats" class="hidden">
        <!-- Driver Header Card -->
        <div class="glass-card rounded-2xl p-6 sm:p-8 mb-6">
          <div
            class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6"
          >
            <div class="flex items-center gap-5">
              <div
                class="w-20 h-20 rounded-2xl bg-gradient-to-br from-amber-500/20 to-blue-500/20 flex items-center justify-center text-4xl border border-amber-500/20"
              >
                üèéÔ∏è
              </div>
              <div>
                <h3
                  id="driver-name"
                  class="font-racing text-2xl sm:text-3xl font-bold text-white mb-1"
                >
                  Driver Name
                </h3>
                <p id="driver-guid" class="text-slate-500 text-sm font-mono">
                  GUID: 76561198000000000
                </p>
              </div>
            </div>
            <div
              class="flex flex-col items-start sm:items-end gap-1 text-slate-400 text-sm"
            >
              <p id="driver-summary">Select a driver to view stats</p>
            </div>
          </div>
        </div>

        <!-- Main Stats Grid -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <span class="text-slate-400 text-sm font-medium">Balance</span>
              <span class="text-2xl">üí∞</span>
            </div>
            <p
              id="stat-points"
              class="font-racing text-3xl sm:text-4xl font-bold text-emerald-400"
            >
              $0
            </p>
            <p class="text-slate-500 text-xs mt-2">Total earnings</p>
          </div>

          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <span class="text-slate-400 text-sm font-medium">Wins</span>
              <span class="text-2xl">ü•á</span>
            </div>
            <p
              id="stat-wins"
              class="font-racing text-3xl sm:text-4xl font-bold text-amber-400"
            >
              0
            </p>
            <p id="stat-winrate" class="text-slate-500 text-xs mt-2">
              0% win rate
            </p>
          </div>

          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <span class="text-slate-400 text-sm font-medium">Podiums</span>
              <span class="text-2xl">üèÜ</span>
            </div>
            <p
              id="stat-podiums"
              class="font-racing text-3xl sm:text-4xl font-bold text-white"
            >
              0
            </p>
            <p id="stat-podiumrate" class="text-slate-500 text-xs mt-2">
              0% podium rate
            </p>
          </div>

          <div class="stat-card">
            <div class="flex items-center justify-between mb-4">
              <span class="text-slate-400 text-sm font-medium">Distance</span>
              <span class="text-2xl">üõ£Ô∏è</span>
            </div>
            <p
              id="stat-km"
              class="font-racing text-3xl sm:text-4xl font-bold text-blue-400"
            >
              0 km
            </p>
            <p class="text-slate-500 text-xs mt-2">Total driven</p>
          </div>
        </div>

        <!-- Detailed Stats -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
          <!-- Performance Stats -->
          <div class="glass-card rounded-2xl p-6">
            <h3
              class="font-racing text-xl font-bold text-amber-400 mb-6 flex items-center gap-3"
            >
              <span class="text-2xl">üèÅ</span> Performance
            </h3>
            <div class="space-y-4">
              <div
                class="flex justify-between items-center py-3 border-b border-white/5"
              >
                <span class="text-slate-400">Pole Positions</span>
                <span
                  id="stat-poles"
                  class="font-mono text-amber-400 font-bold text-lg"
                  >0</span
                >
              </div>
              <div
                class="flex justify-between items-center py-3 border-b border-white/5"
              >
                <span class="text-slate-400">Fastest Laps</span>
                <span
                  id="stat-flaps"
                  class="font-mono text-purple-400 font-bold text-lg"
                  >0</span
                >
              </div>
              <div
                class="flex justify-between items-center py-3 border-b border-white/5"
              >
                <span class="text-slate-400">Races Completed</span>
                <span
                  id="stat-races"
                  class="font-mono text-white font-bold text-lg"
                  >0</span
                >
              </div>
              <div class="flex justify-between items-center py-3">
                <span class="text-slate-400">Laps Completed</span>
                <span
                  id="stat-laps"
                  class="font-mono text-white font-bold text-lg"
                  >0</span
                >
              </div>
            </div>
          </div>

          <!-- Safety Stats -->
          <div class="glass-card rounded-2xl p-6">
            <h3
              class="font-racing text-xl font-bold text-amber-400 mb-6 flex items-center gap-3"
            >
              <span class="text-2xl">‚ö†Ô∏è</span> Safety Rating
            </h3>
            <div class="space-y-4">
              <div
                class="flex justify-between items-center py-3 border-b border-white/5"
              >
                <span class="text-slate-400">Total Crashes</span>
                <span
                  id="stat-crashes"
                  class="font-mono text-red-400 font-bold text-lg"
                  >0</span
                >
              </div>
              <div
                class="flex justify-between items-center py-3 border-b border-white/5"
              >
                <span class="text-slate-400">Crashes / 100km</span>
                <span
                  id="stat-cr100"
                  class="font-mono text-orange-400 font-bold text-lg"
                  >0.00</span
                >
              </div>
              <div
                class="flex justify-between items-center py-3 border-b border-white/5"
              >
                <span class="text-slate-400">Infractions</span>
                <span
                  id="stat-infr"
                  class="font-mono text-yellow-400 font-bold text-lg"
                  >0</span
                >
              </div>
              <div class="flex justify-between items-center py-3">
                <span class="text-slate-400">Infractions / 100km</span>
                <span
                  id="stat-infr100"
                  class="font-mono text-yellow-400 font-bold text-lg"
                  >0.00</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Driver State -->
      <div id="no-driver" class="text-center py-20">
        <div class="text-7xl mb-6 animate-float">üîç</div>
        <h3 class="font-racing text-2xl text-slate-300 mb-3">
          Search for a Driver
        </h3>
        <p class="text-slate-500 max-w-md mx-auto">
          Enter a driver name or Steam64 ID above to view their complete racing
          statistics and licence status.
        </p>
      </div>
    </div>

    <!-- Leaderboard Page -->
    <div
      id="page-leaderboard"
      class="page hidden max-w-7xl mx-auto px-4 sm:px-6 py-10"
    >
      <!-- Header -->
      <div class="mb-10">
        <h2
          class="font-racing text-3xl sm:text-4xl font-bold text-amber-400 text-glow mb-2"
        >
          üèÜ Leaderboard
        </h2>
        <p class="text-slate-400">
          Best lap times for Tatuus FA01 across all tracks
        </p>
      </div>

      <!-- Track Selection -->
      <div class="glass-card rounded-2xl p-6 mb-6">
        <label class="block text-slate-300 text-sm font-medium mb-4"
          >Select Track</label
        >
        <div class="flex flex-wrap gap-2" id="track-buttons">
          <!-- Populated by JS -->
        </div>
      </div>

      <!-- Track Info Bar -->
      <div
        class="glass-card rounded-xl px-6 py-4 mb-6 flex flex-wrap items-center justify-between gap-4"
      >
        <div class="flex items-center gap-6">
          <div>
            <span class="text-slate-500 text-xs uppercase tracking-wider"
              >Track</span
            >
            <p id="current-track" class="font-racing text-amber-400 text-lg">
              -
            </p>
          </div>
          <div class="hidden sm:block w-px h-10 bg-white/10"></div>
          <div class="hidden sm:block">
            <span class="text-slate-500 text-xs uppercase tracking-wider"
              >Car</span
            >
            <p class="font-mono text-white">tatuusfa1</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-slate-500 text-sm">Entries:</span>
          <span id="entry-count" class="font-racing text-emerald-400 text-xl"
            >0</span
          >
        </div>
      </div>

      <!-- Leaderboard Table -->
      <div class="glass-card rounded-2xl overflow-hidden mb-6">
        <div class="overflow-x-auto">
          <table class="table-modern w-full">
            <thead>
              <tr class="text-left text-slate-400">
                <th class="py-5 px-6 w-20">Pos</th>
                <th class="py-5 px-6">Driver</th>
                <th class="py-5 px-6">Lap Time</th>
                <th class="py-5 px-6">Gap</th>
              </tr>
            </thead>
            <tbody id="leaderboard-body" class="text-slate-300">
              <!-- Populated by JS -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Pagination -->
      <div class="flex justify-center gap-2" id="pagination">
        <!-- Populated by JS -->
      </div>

      <!-- No Data State -->
      <div id="no-leaderboard" class="hidden text-center py-20">
        <div class="text-7xl mb-6 animate-float">üìä</div>
        <h3 class="font-racing text-2xl text-slate-300 mb-3">
          No Lap Times Yet
        </h3>
        <p class="text-slate-500">
          Select a track above to view the leaderboard
        </p>
      </div>
    </div>

    <!-- Setup Shop Page -->
    <div
      id="page-shop"
      class="page hidden max-w-7xl mx-auto px-4 sm:px-6 py-10"
    >
      <!-- Header -->
      <div class="mb-10">
        <h2
          class="font-racing text-3xl sm:text-4xl font-bold text-amber-400 text-glow mb-2"
        >
          üõí Setup Shop
        </h2>
        <p class="text-slate-400">
          Premium Tatuus FA01 setups crafted by top drivers
        </p>
      </div>

      <!-- Track Filter -->
      <div class="glass-card rounded-2xl p-6 mb-8">
        <div class="flex flex-wrap gap-2">
          <button
            onclick="filterShop('all')"
            class="shop-btn btn-gold px-5 py-2.5 rounded-xl font-semibold text-sm"
            data-track="all"
          >
            All Tracks
          </button>
          <button
            onclick="filterShop('ks_zandvoort')"
            class="shop-btn btn-ghost px-5 py-2.5 rounded-xl font-semibold text-sm"
            data-track="ks_zandvoort"
          >
            Zandvoort
          </button>
          <button
            onclick="filterShop('spa')"
            class="shop-btn btn-ghost px-5 py-2.5 rounded-xl font-semibold text-sm"
            data-track="spa"
          >
            Spa
          </button>
          <button
            onclick="filterShop('ks_silverstone')"
            class="shop-btn btn-ghost px-5 py-2.5 rounded-xl font-semibold text-sm"
            data-track="ks_silverstone"
          >
            Silverstone
          </button>
          <button
            onclick="filterShop('ks_monza66')"
            class="shop-btn btn-ghost px-5 py-2.5 rounded-xl font-semibold text-sm"
            data-track="ks_monza66"
          >
            Monza
          </button>
          <button
            onclick="filterShop('imola')"
            class="shop-btn btn-ghost px-5 py-2.5 rounded-xl font-semibold text-sm"
            data-track="imola"
          >
            Imola
          </button>
        </div>
      </div>

      <!-- Setup Grid -->
      <div
        id="shop-grid"
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
      >
        <!-- Populated by JS -->
      </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-white/5 mt-16 py-10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <div class="flex items-center justify-center gap-4 mb-6">
          <div class="logo-container w-10 h-10">
            <img
              src="logo.png"
              alt="AC Elite"
              onerror="this.parentElement.innerHTML='<div class=\'w-full h-full gold-gradient flex items-center justify-center rounded-lg\'><span class=\'font-racing font-black text-[#0a1628] text-sm\'>AC</span></div>'"
            />
          </div>
          <span class="font-racing text-xl text-amber-400">AC ELITE</span>
        </div>
        <p class="text-slate-500 text-sm mb-2">
          Vote for next week's track on Discord ‚Ä¢ discord.gg/d2EbxGYBbj
        </p>
        <p class="text-slate-600 text-xs" id="last-sync">
          Data synced via GitHub Actions
        </p>
      </div>
    </footer>

    <script>
      /* ===================== CONFIGURATION ===================== */

      // Data URL - uses relative path for GitHub Pages
      const DATA_BASE_URL = "./data";
      const CAR = "tatuusfa1";

      let leaderboardData = {};
      let rankData = [];
      let metadata = {};
      let dataLoaded = false;

      /* ===================== DATA FETCHING ===================== */

      async function fetchJSON(filename) {
        const url = `${DATA_BASE_URL}/${filename}?t=${Date.now()}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return response.json();
      }

      async function loadAllData() {
        showLoading(true);
        updateLoadingStatus("Fetching race data...");

        try {
          const [rankResult, leaderboardResult, metadataResult] =
            await Promise.allSettled([
              fetchJSON("rank.json"),
              fetchJSON("leaderboard.json"),
              fetchJSON("metadata.json"),
            ]);

          if (rankResult.status === "fulfilled") {
            rankData = rankResult.value;
          }

          if (leaderboardResult.status === "fulfilled") {
            leaderboardData = leaderboardResult.value;
          }

          if (metadataResult.status === "fulfilled") {
            metadata = metadataResult.value;
          }

          dataLoaded =
            rankData.length > 0 || Object.keys(leaderboardData).length > 0;

          showLoading(false);
          updateDataStatus(dataLoaded);
          updateQuickStats();
          updateLastSync();
        } catch (err) {
          console.error("Failed to load data:", err);
          showLoading(false);
          updateDataStatus(false);
        }

        return dataLoaded;
      }

      function showLoading(show) {
        document
          .getElementById("loading-overlay")
          .classList.toggle("hidden", !show);
      }

      function updateLoadingStatus(text) {
        document.getElementById("loading-status").textContent = text;
      }

      function updateDataStatus(success) {
        const status = document.getElementById("data-status");
        if (success) {
          const timeAgo = getTimeAgo(metadata.lastSync);
          status.innerHTML = `
                    <span class="relative flex h-2.5 w-2.5">
                        <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                    </span>
                    <span class="text-sm text-slate-300">${timeAgo}</span>
                `;
        } else {
          status.innerHTML = `
                    <span class="relative flex h-2.5 w-2.5">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"></span>
                    </span>
                    <span class="text-sm text-red-300">Failed to load data</span>
                `;
        }
      }

      function getTimeAgo(dateString) {
        if (!dateString) return "Synced recently";

        const now = new Date();
        const date = new Date(dateString);
        const seconds = Math.floor((now - date) / 1000);

        if (seconds < 60) return "Synced just now";
        if (seconds < 120) return "Synced 1 min ago";
        if (seconds < 3600) return `Synced ${Math.floor(seconds / 60)} min ago`;
        if (seconds < 7200) return "Synced 1 hour ago";
        if (seconds < 86400)
          return `Synced ${Math.floor(seconds / 3600)} hours ago`;
        return `Synced ${Math.floor(seconds / 86400)} days ago`;
      }

      function updateLastSync() {
        if (metadata.lastSync) {
          const timeAgo = getTimeAgo(metadata.lastSync);
          document.getElementById(
            "last-sync"
          ).textContent = `${timeAgo} ‚Ä¢ Auto-sync every 5 minutes`;
        }
      }

      function updateQuickStats() {
        document.getElementById("total-drivers").textContent =
          rankData.length.toLocaleString();
        document.getElementById("total-tracks").textContent =
          Object.keys(leaderboardData).length;

        let totalLaps = 0;
        Object.values(leaderboardData).forEach((track) => {
          Object.values(track).forEach((car) => {
            totalLaps += car.length;
          });
        });
        document.getElementById("total-laps").textContent =
          totalLaps.toLocaleString();

        const totalKm = rankData.reduce(
          (sum, d) => sum + (d.kilometers || 0),
          0
        );
        document.getElementById("total-km").textContent =
          Math.round(totalKm).toLocaleString();
      }

      /* ===================== TRACK NAMES ===================== */

      const trackNames = {
        ks_barcelona_layout_gp: "Barcelona - GP",
        ks_barcelona_layout_moto: "Barcelona - Moto",
        ks_black_cat_county_layout_short: "Black Cat County - Short",
        ks_brands_hatch_gp: "Brands Hatch - GP",
        imola_: "Imola",
        ks_laguna_seca_: "Laguna Seca",
        magione_: "Magione",
        monza_: "Monza",
        ks_monza66_junior: "Monza 1966 - Junior Course",
        ks_monza66_road: "Monza 1966 - Road Course",
        mugello_: "Mugello",
        ks_nordschleife_nordschleife: "Nordschleife",
        ks_nordschleife_endurance: "Nordschleife Endurance",
        ks_nurburgring_layout_gp_a: "N√ºrburgring GP",
        ks_nurburgring_layout_gp_b: "N√ºrburgring GP - GT",
        ks_red_bull_ring_layout_gp: "Red Bull Ring - GP",
        ks_silverstone_gp: "Silverstone - GP",
        ks_silverstone_national: "Silverstone - National",
        spa_: "Spa",
        ks_vallelunga_extended_circuit: "Vallelunga",
        ks_zandvoort_: "Zandvoort",
      };

      function getTrackDisplayName(trackId) {
        return (
          trackNames[trackId] || trackId.replace(/_/g, " ").replace(/-/g, " ")
        );
      }

      /* ===================== SETUP SHOP ===================== */

      const setups = [
        {
          id: 1,
          track: "ks_zandvoort",
          name: "Zandvoort Banking Special",
          author: "MaxSpeed_Pro",
          rating: 4.9,
          price: 550,
          description:
            "Optimized for the banked corners. High downforce for maximum grip.",
        },
        {
          id: 2,
          track: "ks_zandvoort",
          name: "Zandvoort All-Rounder",
          author: "DutchRacer",
          rating: 4.7,
          price: 400,
          description: "Great balance for both quali and race.",
        },
        {
          id: 3,
          track: "spa",
          name: "Spa Quali Beast",
          author: "SpaKing_Pro",
          rating: 4.9,
          price: 600,
          description: "Low downforce, maximum speed through Eau Rouge.",
        },
        {
          id: 4,
          track: "spa",
          name: "Spa Race Setup",
          author: "RacerX_Elite",
          rating: 4.7,
          price: 450,
          description: "Balanced setup with good tire preservation.",
        },
        {
          id: 5,
          track: "ks_silverstone",
          name: "Silverstone Fast Sectors",
          author: "BritishRacer",
          rating: 4.9,
          price: 600,
          description: "Built for the high-speed Maggots-Becketts section.",
        },
        {
          id: 6,
          track: "ks_monza66",
          name: "Monza Speedtrap King",
          author: "ItalianSpeed",
          rating: 4.8,
          price: 500,
          description: "Lowest drag setup. 310+ km/h guaranteed.",
        },
        {
          id: 7,
          track: "imola",
          name: "Imola Technical Master",
          author: "ImolaKing",
          rating: 4.7,
          price: 550,
          description: "Great traction out of slow corners.",
        },
      ];

      /* ===================== SCORE CALCULATION (voor later) ===================== */

      function calculateScore(d) {
        const km = Math.max(1, d.kilometers ?? 0);
        const crashes = d.crashes ?? d.collisions ?? 0;
        const infr = d.infr ?? 0;

        const cr_per_100km = km > 0 ? crashes / (km / 100) : 0;
        const infr_per_100km = km > 0 ? infr / (km / 100) : 0;

        const winRate = (d.wins ?? 0) / (km / 1000);
        const podiumRate = (d.podiums ?? 0) / (km / 1000);
        const poleRate = (d.poles ?? 0) / (km / 1000);
        const flapRate = (d.flaps ?? 0) / (km / 1000);
        const enduranceBonus = Math.log10(km);

        return (
          winRate * 30 +
          podiumRate * 20 +
          poleRate * 15 +
          flapRate * 12 +
          enduranceBonus * 10 +
          (d.points ?? 0) * 0.05 -
          infr * 1.5 -
          crashes * 2.0 -
          infr_per_100km * 25 -
          cr_per_100km * 30
        );
      }

      function getLicence(score) {
        if (score >= 700)
          return { name: "Platinum Licence", class: "licence-platinum" };
        if (score >= 500)
          return { name: "Gold Licence", class: "licence-gold" };
        if (score >= 200)
          return { name: "Silver Licence", class: "licence-silver" };
        return { name: "Bronze Licence", class: "licence-bronze" };
      }

      function formatLaptime(ms) {
        const min = Math.floor(ms / 60000);
        const sec = ((ms / 1000) % 60).toFixed(3).padStart(6, "0");
        return `${min}:${sec}`;
      }

      function calculateGap(fastestLap, currentLap) {
        if (fastestLap === currentLap) return "-";
        return `+${((currentLap - fastestLap) / 1000).toFixed(3)}`;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      /* ===================== NAVIGATION ===================== */

      let currentTrack = null;
      let currentPage = 1;
      const itemsPerPage = 15;
      let currentShopFilter = "all";

      function showPage(page) {
        document
          .querySelectorAll(".page")
          .forEach((p) => p.classList.add("hidden"));
        document.getElementById(`page-${page}`).classList.remove("hidden");

        document.querySelectorAll(".nav-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        document.getElementById(`nav-${page}`).classList.add("active");

        if (page === "leaderboard") {
          renderTrackButtons();
          if (!currentTrack && Object.keys(leaderboardData).length > 0) {
            selectTrack(Object.keys(leaderboardData)[0]);
          }
        }
        if (page === "shop") renderShop();
      }

      /* ===================== AUTOCOMPLETE ===================== */

      const searchInput = document.getElementById("driver-search");
      const autocompleteResults = document.getElementById(
        "autocomplete-results"
      );
      let autocompleteTimeout;

      searchInput.addEventListener("input", function () {
        clearTimeout(autocompleteTimeout);
        const query = this.value.trim().toLowerCase();

        if (query.length < 2) {
          autocompleteResults.classList.remove("show");
          return;
        }

        autocompleteTimeout = setTimeout(() => {
          const matches = rankData
            .filter(
              (d) =>
                d.name.toLowerCase().includes(query) || d.guid.includes(query)
            )
            .slice(0, 8);
          if (matches.length === 0) {
            autocompleteResults.classList.remove("show");
            return;
          }

          autocompleteResults.innerHTML = matches
            .map(
              (d) => `
                    <div class="autocomplete-item" onclick="selectDriver('${
                      d.guid
                    }')">
                        <div class="autocomplete-name">${escapeHtml(
                          d.name
                        )}</div>
                        <div class="autocomplete-guid">${d.guid}</div>
                    </div>
                `
            )
            .join("");
          autocompleteResults.classList.add("show");
        }, 150);
      });

      searchInput.addEventListener("keyup", (e) => {
        if (e.key === "Enter") {
          autocompleteResults.classList.remove("show");
          searchDriver();
        }
      });
      document.addEventListener("click", (e) => {
        if (!e.target.closest(".autocomplete-container"))
          autocompleteResults.classList.remove("show");
      });

      function selectDriver(guid) {
        const driver = rankData.find((d) => d.guid === guid);
        if (driver) {
          searchInput.value = driver.name;
          autocompleteResults.classList.remove("show");
          displayDriverStats(driver);
        }
      }

      /* ===================== STATS PAGE ===================== */

      function searchDriver() {
        const query = document
          .getElementById("driver-search")
          .value.trim()
          .toLowerCase();
        if (!query) return;

        const driver = rankData.find(
          (d) => d.name.toLowerCase().includes(query) || d.guid.includes(query)
        );

        if (!driver) {
          document.getElementById("driver-stats").classList.add("hidden");
          document.getElementById("no-driver").classList.remove("hidden");
          document.getElementById("no-driver").innerHTML = `
                    <div class="text-7xl mb-6">‚ùå</div>
                    <h3 class="font-racing text-2xl text-slate-300 mb-3">Driver Not Found</h3>
                    <p class="text-slate-500 max-w-md mx-auto">No driver matches "${escapeHtml(
                      query
                    )}". Try a different search term.</p>
                `;
          return;
        }
        displayDriverStats(driver);
      }

      function displayDriverStats(driver) {
        document.getElementById("no-driver").classList.add("hidden");
        document.getElementById("driver-stats").classList.remove("hidden");

        const km = driver.kilometers || 0;

        // Total laps uit driver.leaderboard -> [track][CAR].laps
        let totalLaps = 0;
        if (typeof driver.laps === "number") {
          totalLaps = driver.laps;
        } else if (driver.leaderboard) {
          Object.values(driver.leaderboard).forEach((trackObj) => {
            const carStats = trackObj[CAR];
            if (carStats && typeof carStats.laps === "number") {
              totalLaps += carStats.laps;
            }
          });
        }

        const crashes = driver.crashes ?? driver.collisions ?? 0;
        const infr = driver.infr ?? 0;

        const crPer100 = km > 0 ? crashes / (km / 100) : 0;
        const infrPer100 = km > 0 ? infr / (km / 100) : 0;

        const races = driver.races || 0;
        const winRate = races > 0 ? ((driver.wins || 0) / races) * 100 : 0;
        const podiumRate =
          races > 0 ? ((driver.podiums || 0) / races) * 100 : 0;

        // Header
        document.getElementById("driver-name").textContent = driver.name;
        document.getElementById(
          "driver-guid"
        ).textContent = `GUID: ${driver.guid}`;

        const summaryEl = document.getElementById("driver-summary");
        if (summaryEl) {
          summaryEl.textContent = `Wins: ${driver.wins || 0} ‚Ä¢ Podiums: ${
            driver.podiums || 0
          } ‚Ä¢ Distance: ${km.toFixed(1)} km`;
        }

        // Main stats
        document.getElementById("stat-points").textContent = `$${(
          driver.points || 0
        ).toLocaleString()}`;

        document.getElementById("stat-wins").textContent = driver.wins || 0;
        document.getElementById(
          "stat-winrate"
        ).textContent = `${winRate.toFixed(1)}% win rate`;

        document.getElementById("stat-podiums").textContent =
          driver.podiums || 0;
        document.getElementById(
          "stat-podiumrate"
        ).textContent = `${podiumRate.toFixed(1)}% podium rate`;

        document.getElementById("stat-km").textContent = `${km.toFixed(1)} km`;

        document.getElementById("stat-poles").textContent = driver.poles || 0;
        document.getElementById("stat-flaps").textContent = driver.flaps || 0;

        document.getElementById("stat-races").textContent = races;
        document.getElementById("stat-laps").textContent =
          totalLaps.toLocaleString();

        document.getElementById("stat-crashes").textContent = crashes;
        document.getElementById("stat-cr100").textContent = crPer100.toFixed(2);

        document.getElementById("stat-infr").textContent = infr;
        document.getElementById("stat-infr100").textContent =
          infrPer100.toFixed(2);
      }

      /* ===================== LEADERBOARD ===================== */

      function renderTrackButtons() {
        const container = document.getElementById("track-buttons");
        const tracks = Object.keys(leaderboardData).sort();
        if (tracks.length === 0) {
          container.innerHTML =
            '<p class="text-slate-500">No tracks available</p>';
          return;
        }
        container.innerHTML = tracks
          .map(
            (track) => `
                <button onclick="selectTrack('${track}')" class="track-btn btn-ghost px-4 py-2.5 rounded-xl font-semibold text-sm transition-all ${
              currentTrack === track
                ? "active !bg-amber-500/20 !border-amber-500 !text-amber-400"
                : ""
            }">${getTrackDisplayName(track)}</button>
            `
          )
          .join("");
      }

      function selectTrack(track) {
        currentTrack = track;
        currentPage = 1;
        renderTrackButtons();
        renderLeaderboard();
      }

      function renderLeaderboard() {
        if (!currentTrack || !leaderboardData[currentTrack]) {
          document.getElementById("no-leaderboard").classList.remove("hidden");
          document.getElementById("leaderboard-body").innerHTML = "";
          document.getElementById("pagination").innerHTML = "";
          return;
        }

        document.getElementById("no-leaderboard").classList.add("hidden");
        document.getElementById("current-track").textContent =
          getTrackDisplayName(currentTrack);

        const carData = leaderboardData[currentTrack][CAR] || [];
        const sorted = [...carData].sort((a, b) => a.laptime - b.laptime);
        document.getElementById("entry-count").textContent = sorted.length;

        const totalPages = Math.ceil(sorted.length / itemsPerPage);
        const start = (currentPage - 1) * itemsPerPage;
        const paginated = sorted.slice(start, start + itemsPerPage);
        const fastestLap = sorted.length > 0 ? sorted[0].laptime : 0;

        const tbody = document.getElementById("leaderboard-body");
        if (sorted.length === 0) {
          tbody.innerHTML = `<tr><td colspan="4" class="py-12 text-center text-slate-500">No lap times recorded for ${CAR} on this track</td></tr>`;
          document.getElementById("pagination").innerHTML = "";
          return;
        }

        tbody.innerHTML = paginated
          .map((entry, index) => {
            const pos = start + index + 1;
            let rowClass = "",
              posClass = "bg-slate-700/50 text-slate-300",
              medal = "";
            if (pos === 1) {
              rowClass = "top1";
              posClass = "bg-yellow-500 text-slate-900 font-bold";
              medal = " ü•á";
            } else if (pos === 2) {
              rowClass = "top2";
              posClass = "bg-slate-400 text-slate-900 font-bold";
              medal = " ü•à";
            } else if (pos === 3) {
              rowClass = "top3";
              posClass = "bg-amber-600 text-slate-900 font-bold";
              medal = " ü•â";
            } else if (pos <= 10) {
              rowClass = "top10";
              posClass = "bg-blue-600 text-white";
            }

            return `<tr class="border-b border-white/5 ${rowClass} cursor-pointer hover:bg-white/5"
                      onclick="openDriverFromLeaderboard('${
                        entry.guid || ""
                      }')">
                    <td class="py-4 px-6"><span class="px-3 py-1.5 rounded-lg text-sm ${posClass}">${pos}</span></td>
                    <td class="py-4 px-6 font-semibold">${escapeHtml(
                      entry.name?.slice(0, 30) || "Unknown"
                    )}${medal}</td>
                    <td class="py-4 px-6 font-mono text-amber-400 font-bold text-lg">${formatLaptime(
                      entry.laptime
                    )}</td>
                    <td class="py-4 px-6 font-mono text-slate-500">${calculateGap(
                      fastestLap,
                      entry.laptime
                    )}</td>
                </tr>`;
          })
          .join("");

        const pagination = document.getElementById("pagination");
        if (totalPages > 1) {
          let html = `<button onclick="goToPage(${currentPage - 1})" ${
            currentPage === 1 ? "disabled" : ""
          } class="btn-ghost px-4 py-2 rounded-xl disabled:opacity-30 disabled:cursor-not-allowed">‚Üê</button>`;
          for (let i = 1; i <= totalPages; i++) {
            if (
              i === 1 ||
              i === totalPages ||
              (i >= currentPage - 1 && i <= currentPage + 1)
            ) {
              html += `<button onclick="goToPage(${i})" class="${
                currentPage === i ? "btn-gold" : "btn-ghost"
              } px-4 py-2 rounded-xl">${i}</button>`;
            } else if (i === currentPage - 2 || i === currentPage + 2) {
              html += `<span class="px-2 text-slate-600">...</span>`;
            }
          }
          html += `<button onclick="goToPage(${currentPage + 1})" ${
            currentPage === totalPages ? "disabled" : ""
          } class="btn-ghost px-4 py-2 rounded-xl disabled:opacity-30 disabled:cursor-not-allowed">‚Üí</button>`;
          pagination.innerHTML = html;
        } else {
          pagination.innerHTML = "";
        }
      }

      function goToPage(page) {
        const carData = leaderboardData[currentTrack]?.[CAR] || [];
        const totalPages = Math.ceil(carData.length / itemsPerPage);
        if (page >= 1 && page <= totalPages) {
          currentPage = page;
          renderLeaderboard();
        }
      }

      function openDriverFromLeaderboard(guid) {
        if (!guid) return;
        const driver = rankData.find((d) => d.guid === guid);
        if (!driver) return;
        showPage("stats");
        const searchInput = document.getElementById("driver-search");
        if (searchInput) {
          searchInput.value = driver.name;
        }
        displayDriverStats(driver);
      }

      /* ===================== SHOP ===================== */

      function filterShop(track) {
        currentShopFilter = track;
        document.querySelectorAll(".shop-btn").forEach((btn) => {
          btn.classList.remove("btn-gold");
          btn.classList.add("btn-ghost");
        });
        const activeBtn = document.querySelector(
          `.shop-btn[data-track="${track}"]`
        );
        if (activeBtn) {
          activeBtn.classList.remove("btn-ghost");
          activeBtn.classList.add("btn-gold");
        }
        renderShop();
      }

      function renderShop() {
        const filtered =
          currentShopFilter === "all"
            ? setups
            : setups.filter((item) => item.track === currentShopFilter);
        const grid = document.getElementById("shop-grid");
        grid.innerHTML = filtered
          .map(
            (setup) => `
                <div class="glass-card rounded-2xl p-6 group">
                    <div class="flex items-start justify-between mb-4">
                        <span class="text-xs bg-blue-500/20 text-blue-300 px-3 py-1.5 rounded-lg font-medium">${getTrackDisplayName(
                          setup.track
                        )}</span>
                        <div class="flex items-center gap-1.5 text-amber-400">
                            <span>‚òÖ</span>
                            <span class="text-sm font-medium">${
                              setup.rating
                            }</span>
                        </div>
                    </div>
                    <h3 class="font-racing text-lg font-bold text-white mb-2 group-hover:text-amber-400 transition-colors">${escapeHtml(
                      setup.name
                    )}</h3>
                    <p class="text-slate-500 text-sm mb-3">by ${escapeHtml(
                      setup.author
                    )}</p>
                    <p class="text-slate-400 text-sm mb-6 leading-relaxed">${escapeHtml(
                      setup.description
                    )}</p>
                    <div class="flex items-center justify-between pt-4 border-t border-white/5">
                        <span class="font-racing text-2xl font-bold text-emerald-400">$${
                          setup.price
                        }</span>
                        <button onclick="buySetup(${
                          setup.id
                        })" class="btn-gold px-5 py-2.5 rounded-xl text-sm">
                            Buy Setup
                        </button>
                    </div>
                </div>
            `
          )
          .join("");

        if (filtered.length === 0) {
          grid.innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <div class="text-5xl mb-4">üîß</div>
                        <p class="text-slate-400">No setups available for this track yet</p>
                    </div>
                `;
        }
      }

      function buySetup(id) {
        const setup = setups.find((s) => s.id === id);
        alert(
          `Redirecting to purchase: ${setup.name}\nPrice: $${setup.price}\n\nThis would connect to your payment system.`
        );
      }

      function showComingSoon() {
        alert("Setups are coming soon! The shop is currently locked.");
      }

      /* ===================== INIT ===================== */

      document.addEventListener("DOMContentLoaded", async () => {
        await loadAllData();
        renderShop();
      });
    </script>
  </body>
</html>
